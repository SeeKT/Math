\documentclass{jsreport}
\input{../preamble.tex}
\begin{document}
\chapter{2変量 (多変量) 確率ベクトルの分布}
\section{$n$次元確率ベクトルの同時分布}
一般に，$n$個の1次元確率変数$X_1, X_2, \ldots, X_n$に対して，
$\bm{X} = (X_1, X_2, \ldots, X_n)$を$n$次元確率ベクトル (random vector, r.vec.)，
$P(a_1 \leq X_1 \leq b_1, a_2 \leq X_2 \leq b_2, \cdots, a_n \leq X_n \leq b_n), \, a_i \leq b_i \, (i = 1, 2, \ldots, n)$を$\bm{X}$の同時確率分布という．
$F_{\bm{X}}(x_1, \cdots x_n) = P(X_1 \leq x_1, \cdots, X_n \leq x_n)$を$\bm{X}$の同時分布関数という．以降，主に連続型について述べる．

\begin{screen}
  \begin{defi}[同時確率密度関数]
    $\bm{X} = (X_1, \ldots, X_n)$を$n$次元確率ベクトルとする．
    \begin{equation}
      P(a_1 \leq X_1 \leq b_1, \cdots, a_n \leq X_n \leq b_n) = \int_{a_1}^{b_1} \cdots \int_{a_n}^{b_n} f_{\bm{X}}(x_1, \cdots, x_n) dx_1 \cdots dx_n \nonumber
    \end{equation}
    で与えられ，次を満たす$f_{\bm{X}}(x_1, \cdots, x_n)$を$\bm{X}$の(n次元)同時確率密度関数(joint p.d.f.)という．
    \begin{enumerate}
      \item $f_{\bm{X}}(x_1, \cdots, x_n) \geq 0$.
      \item $\int_{-\infty}^{\infty} \cdots \int_{-\infty}^{\infty} f_{\bm{X}}(x_1, \cdots, x_n) dx_1 \cdots dx_n = 1$.
    \end{enumerate}
  \end{defi}
\end{screen}

同時確率密度関数は，
\begin{equation}
  f_{\bm{X}}(x_1, \cdots, x_n) = \frac{\partial^n}{\partial x_1 \cdots \partial x_n} F_{\bm{X}}(x_1, \cdots, x_n) \nonumber
\end{equation}
および
\begin{equation}
  F_{\bm{X}}(x_1, \cdots, x_n) = \int_{-\infty}^{x_1} \cdots \int_{-\infty}^{x_n} f_{\bm{X}}(y_1, \cdots, y_n) dy_1 \cdots dy_n \nonumber
\end{equation}
を満たす．

各成分だけに注目した分布関数
\begin{align}
  F_i(x_i) &= F_{\bm{X}}(\infty, \cdots, \infty, x_i, \infty, \cdots, \infty) \nonumber \\
   &= P(X_1 \in \mathbb{R}, \cdots, X_{i - 1} \in \mathbb{R}, X_i \leq x_i, X_{i + 1} \in \mathbb{R}, \cdots, X_n \in \mathbb{R}) \nonumber \\
   &= P(X_i \leq x_i) \nonumber
\end{align}
を$X_i$の周辺分布関数という．その分布関数を
\begin{equation}
  f_{X_i}(x_i) = \frac{\partial F_i(x_i)}{\partial x_i} = \int_{-\infty}^{\infty} \cdots \int_{-\infty}^{\infty} f(x_1, \cdots, x_n) dx_1 \cdots dx_{i - 1} dx_{i + 1} \cdots dx_n \nonumber
\end{equation}
を周辺確率密度関数という．周辺確率密度関数は，
\begin{equation}
  \int_{-\infty}^{x_i} f_{X_i}(x) dx = F_i(x_i) \nonumber
\end{equation}
を満たす．

\begin{screen}
  \begin{defi}[確率変数の独立]
    任意の$a_i \leq b_i \, (i = 1, 2, \ldots, n)$に対して，
    \begin{align}
      P(a_1 \leq X_1 \leq b_1, \cdots, a_n \leq X_n \leq b_n) &= P(a_1 \leq X_1 \leq b_1) \cdots P(a_n \leq X_n \leq b_n) \nonumber \\
      &= \prod_{i = 1}^n P(a_i \leq X_i \leq b_i) \nonumber
    \end{align}
    が成り立つとき，確率変数$X_1, \ldots, X_n$は互いに独立であるという．
  \end{defi}
\end{screen}

以下に独立性と同値な条件を示す．

$\bm{X} = (X_1, \ldots, X_n)$を$n$次元確率ベクトルとする．このとき，「確率変数$X_1, \ldots, X_n$が互いに独立である」ことと「任意の$(x_1, \cdots, x_n) \in \mathbb{R}^n$に対して
\begin{equation}
  F_{\bm{X}}(x_1, \cdots, x_n) = \prod_{i = 1}^n F_{X_i}(x_i) \nonumber
\end{equation}
が成り立つ」ことは同値である．

$\bm{X} = (X_1, \ldots, X_n)$を$n$次元離散型確率ベクトルとし，$\bm{X}$のとりうる値$\bm{x} = (x_1, \ldots, x_n)$の集合を$E$とする．このとき，「確率変数$X_1, \ldots, X_n$が互いに独立である」ことと「任意の$(x_1, \cdots, x_n) \in E$に対して
\begin{equation}
  P(X_1 = x_1, \cdots, X_n = x_n) = \prod_{i = 1}^n P(X_i = x_i) \nonumber
\end{equation}
が成り立つ」ことは同値である．

$\bm{X} = (X_1, \ldots, X_n)$を$n$次元連続型確率ベクトルとする ($\bm{X} \sim f_{\bm{X}}(\bm{x}), \, X_i \sim f_{X_i}(x_i)$)．このとき，「確率変数$X_1, \ldots, X_n$が互いに独立である」ことと「任意の$a_i \leq b_i \, (i = 1, 2, \ldots, n)$に対して
\begin{equation}
  \int_{a_1}^{b_1} \cdots \int_{a_n}^{b_n} f_{\bm{X}}(x_1, \cdots, x_n) dx_1 \cdots dx_n = \int_{a_1}^{b_1} \cdots \int_{a_n}^{b_n} \prod_{i = 1}^n f_{X_i}(x_i) dx_1 \cdots dx_n \nonumber
\end{equation}
が成り立つ」ことは同値である\footnote{
$f_{\bm{X}}(x_1, \cdots, x_n)$が$\forall (x_1, \cdots, x_n) \in \mathbb{R}^n$で連続とする．このとき，「確率変数$X_1, \ldots, X_n$が互いに独立である」ことと「任意の$(x_1, \cdots, x_n) \in \mathbb{R}^n$に対して
\begin{equation}
  f_{\bm{X}}(x_1, \cdots, x_n) = \prod_{i = 1}^n f_{X_i}(x_i) \nonumber
\end{equation}
が成り立つ」ことは同値である．
}．

確率変数$X_1, \ldots, X_n$が独立なとき，
\begin{align}
  P(a_1 \leq X_1 \leq b_1, \cdots, a_n \leq X_n \leq b_n) &= \int_{a_1}^{b_1} \cdots \int_{a_n}^{b_n} f_{X_1, \cdots, X_n}(x_1, \cdots, x_n) dx_1 \cdots dx_n \nonumber \\
  &= \int_{a_1}^{b_1} \cdots \int_{a_n}^{b_n} f_{X_1}(x_1) \cdots f_{X_n}(x_n) dx_1 \cdots dx_n \nonumber \\
  &= \left(\int_{a_1}^{b_1} f_{X_1}(x_1) dx_1\right) \cdots \left(\int_{a_n}^{b_n} f_{X_n}(x_n) dx_n\right) \nonumber
\end{align}
が成り立つ．つまり，確率変数が独立のとき，同時確率密度関数の$n$重積分を$n$個の周辺確率密度関数の$1$重積分の積に書き換えることができる．

次に，$n = 2$における条件付き(確率)密度関数を定義する．
\begin{screen}
  \begin{defi}[条件付き密度関数]
    $(X, Y)$を連続型確率ベクトル，$f_{XY}(x, y)$を$(X, Y)$の同時確率密度関数，$f_{X}(x), f_{Y}(y)$を周辺密度関数とする．

    $Y = y$を与えたときの$X$の条件付き(確率)密度関数$f_{X}(x|y)$は，
    \begin{equation}
      f_{X}(x|y) = \frac{f_{XY}(x, y)}{f_{Y}(y)} = \frac{f_{XY}(x, y)}{\int_{-\infty}^{\infty} f_{XY} (x, y)dx} \nonumber
    \end{equation}
    で定義される．ただし，$f_{Y}(y) > 0$である．
  \end{defi}
\end{screen}

離散型確率ベクトルのとき，
\begin{equation}
  \frac{P(X = x, Y = y)}{P(Y = y)} = \frac{P(X = x, Y = y)}{\sum_{x = 1}^{\infty} P(X = x, Y = y)} = P(X = x | Y = y) \nonumber
\end{equation}
を条件付き確率分布という．

$X$の条件付き期待値$E[X | Y = y]$と$X$の条件付き分散$V[X | Y = y]$は，
\begin{align}
  E[X | y] &= E[X | Y = y] = \int_{-\infty}^{\infty} x f_{X} (x | y) dx \nonumber \\
  V[X | y] &= V[X | Y = y] = \int_{-\infty}^{\infty} (x - E[X | Y = y])^2 f_{X}(x, y) dx \nonumber
\end{align}
で定義される．

\section{共分散と相関係数}
$(X, Y)$を確率ベクトル，$h: \mathbb{R}^2 \rightarrow \mathbb{R}$を連続関数とすると，期待値$E[h(X, Y)]$は，
\begin{equation}
  E[h(X, Y)] = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} h(x, y) dF(x, y) \nonumber
\end{equation}
で定義される．離散分布と連続型分布に対しては以下のように計算される:
\begin{align}
  E[h(X, Y)] &= \sum_{j = 1}^r \sum_{k = 1}^c h(x_j, y_k) f(x_j, y_k) \; \; \; (離散) \nonumber \\
  E[h(X, Y)] &= \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} h(x, y) f(x, y) dx dy \; \; \; (連続). \nonumber
\end{align}

$h(x, y) = h_1(x)h_2(y)$とする．このとき，期待値に関して次の性質が成り立つ:
\begin{description}
  \item[(E5)] $E[h_1(X)h_2(Y)] = E[h_2(Y)E[h_1(X)|Y]]$
  \item[(E6)] $X$と$Y$が独立 $\Longleftrightarrow$ $E[h_1(X)h_2(Y)] = E[h_1(X)]E[h_2(Y)]$
\end{description}

\begin{description}
  \item[(E5)の証明]
  条件付き同時確率密度関数の定義より，$f_{XY}(x, y) = f_{X}(x | y)f_{Y}(y)$．
  \begin{align}
    E[h_1(X)h_2(Y)] &= \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} h_1(x)h_2(y) f_{XY}(x, y) dxdy \nonumber \\
    &= \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} h_1(x)h_2(y) f_{X}(x | y)f_{Y}(y) dx dy \nonumber \\
    &= \int_{-\infty}^{\infty} h_2(y) \int_{-\infty}^{\infty} h_1(x) f_{X}(x | y) dx f_{Y}(y) dy \nonumber \\
    &= \int_{-\infty}^{\infty} h_2(y) E[h_1(X) | Y = y] f_Y(y) dy = E[h_2(Y)E[h_1(X)|Y]] \nonumber
  \end{align}
  \item[(E6)の証明]
  $X$と$Y$が独立より，
  \begin{align}
    E[h_1(X)h_2(Y)] &= \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} h_1(x)h_2(y) f_{XY}(x, y) dxdy \nonumber \\
    &= \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} h_1(x)h_2(y) f_X(x) f_Y(y) dxdy \nonumber \\
    &= \int_{-\infty}^{\infty} h_1(x) f_X(x) dx \int_{-\infty}^{\infty}h_2(y)f_Y(y) dy = E[h_1(X)] E[h_2(Y)] \nonumber
  \end{align}
\end{description}

$h(X, Y) = e^{sX + tY}$とすれば(ただし，$s, t \in \mathbb{R}$)同時積率母関数(j.m.g.f.)が定義される．
\begin{equation}
  M(s, t) = E[e^{sX + tY}] = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} e^{sX + tY} f_{XY}(x, y) dx dy. \nonumber
\end{equation}
また，
\begin{equation}
  M_X(s) = E[e^{sX}] = \int_{-\infty}^{\infty} e^{sx}  f_X(x) dx \nonumber
\end{equation}
を$X$の周辺積率母関数という．
\begin{equation}
  X, Y: 独立 \; \Longleftrightarrow M(s, t) = M_X(s) M_Y(t) \nonumber
\end{equation}
である($\Longrightarrow$は明らか．$\Longleftarrow$が重要)．

\begin{screen}
  \begin{defi}[共分散と相関係数]
    $(X, Y)$を確率ベクトル，$E[X] = \mu_x, V[X] = \sigma_x^2, E[Y] = \mu_y, V[Y] = \sigma_y^2$とする．このとき，共分散$Cov(X, Y)$と相関係数$Corr(X, Y)$は次で定義される．
    \begin{description}
      \item[(共分散)]
      \begin{equation}
        Cov(X, Y) = E[(X - \mu_x)(Y - \mu_y)] (= \sigma_{XY}) \nonumber
      \end{equation}
      \item[(相関係数)]
      \begin{equation}
        \rho = Corr(X, Y) = \frac{Cov(X, Y)}{\sqrt{V[X]}\sqrt{V[Y]}} \left( = \frac{\sigma_{XY}}{\sigma_X \sigma_Y}\right) \nonumber
      \end{equation}
    \end{description}
  \end{defi}
\end{screen}

\begin{enumerate}
  \item $Cov(X, Y) = E[XY] - E[X]E[Y]$ (共分散公式)
  \item
  \begin{equation}
    Corr(X, Y) = \frac{E[(X - \mu_x)(Y - \mu_y)]}{\sigma_X \sigma_Y} = E\left[\left(\frac{X - \mu_X}{\sigma_X}\right) \left(\frac{Y - \mu_Y}{\sigma_Y}\right)\right] = E[z_X z_Y] \nonumber
  \end{equation}
  \item $\rho > 0$のときは正の相関，$\rho < 0$のときは負の相関，$\rho = 0$のときは無相関という．
\end{enumerate}

\begin{screen}
  \begin{theo}\label{theo:joint}
    \begin{enumerate}
      \item $|\rho| \leq 1$
      \item $\rho = \pm 1 \Longrightarrow Y = \mu_Y \pm \frac{\sigma_Y}{\sigma_X} (X - \mu_X)$ (複号同順)
      \item $X$と$Y$が独立 $\Longrightarrow$ $Cov(X, Y) = 0, \, \rho = 0$
    \end{enumerate}
  \end{theo}
\end{screen}

\begin{screen}
  \begin{theo}
    $a, b$を定数，$X, Y$を確率変数とする．
    \begin{enumerate}
      \item $E[aX + bY] = aE[X] + bE[Y]$
      \item $V[aX + bY] = a^2V[X] + b^2V[Y] + 2abCov(X, Y)$
      \item $X$と$Y$が独立 $\Longrightarrow$ $V[aX + bY] = a^2V[X] + b^2V[Y]$
    \end{enumerate}
  \end{theo}
\end{screen}
\begin{description}
  \item[2.の証明]
  \begin{align}
    V[aX + bY] &= E[\{(aX + bY) - (aE[X] + bE[Y])\}^2] \nonumber \\
    &= E[\{a(X - E[X]) + b(Y - E[Y])\}^2] \nonumber \\
    &= a^2 E[(X - E[X])^2] + b^2 E[(Y - E[Y])^2] + 2ab E[(X - E[X])(Y - E[Y])] \nonumber \\
    &= a^2 V[X] + b^2 V[Y] + 2ab Cov(X, Y) \nonumber
  \end{align}
\end{description}

\section{2 (多) 変量正規分布}
ここでは，多変量分布の例として，多変量正規分布を紹介する．まず，2次元の正規分布を紹介し，その後，一般の多変量正規分布を紹介する．

\subsection{2変量正規分布 $N_2(\bm{\mu}, \bm{\Sigma})$}
2次元確率ベクトル$(X, Y)$が同時密度関数
\begin{align}
  f_{XY}(x, y) = &\frac{1}{(\sqrt{2\pi})^2 \sqrt{\sigma_X^2 \sigma_Y^2 (1 - \rho^2)}} \nonumber \\
  &\times \exp\left[-\frac{1}{2}\left\{\frac{1}{\sigma_X^2 \sigma_Y^2 (1 - \rho^2)} \left( \sigma_Y^2(x - \mu_X)^2 - 2\rho \sigma_X \sigma_Y (x - \mu_X)(y - \mu_Y) + \sigma_X^2 (y - \mu_Y)^2 \right)\right\}\right] \nonumber
\end{align}
をもつとき，$(X, Y)$は2次元正規分布に従うといい，$(X, Y)^{\mathrm{T}} \sim N_2(\bm{\mu}, \bm{\Sigma})$と表す．
ここで，
\begin{equation}
  \bm{\mu} = \left(
  \begin{array}{c}
    \mu_X \\
    \mu_Y
  \end{array}
  \right), \; \; \;
  \bm{\Sigma} = \left(
  \begin{array}{cc}
    \sigma_X^2 & \rho \sigma_X \sigma_Y \\
    \rho \sigma_X \sigma_Y & \sigma_Y^2
  \end{array}
  \right) \nonumber
\end{equation}
であり，$\bm{\mu}$を2次元期待値(平均)ベクトル，$\bm{\Sigma}$を分散共分散行列という．

$(X, Y)^{\mathrm{T}} \sim N_2(\bm{\mu}, \bm{\Sigma})$のとき，
\begin{equation}
  f_{XY}(x, y) = \frac{1}{(\sqrt{2\pi})^2 |\bm{\Sigma}|^{\frac{1}{2}}} \exp\left\{
  -\frac{1}{2} (\bm{x} - \bm{\mu})^{\mathrm{T}} \bm{\Sigma}^{-1} (\bm{x}-\bm{\mu})
  \right\} \nonumber
\end{equation}
である．ただし，$\bm{x} = (x, y)^{\mathrm{T}}$である．

$X$の周辺分布は$N(\mu_X, \sigma_X^2)$であり，$X$を与えたときの$Y$の条件付き分布は
\begin{equation}
  N\left(\mu_Y + \rho \frac{\sigma_Y}{\sigma_X}(x - \mu_X), (1 - \rho^2)\sigma_Y^2\right) \nonumber
\end{equation}
である．さらに，
\begin{equation}
  Cov(X, Y) = \rho \sigma_X \sigma_Y, \;  \; Corr(X, Y) = \rho \nonumber
\end{equation}
である．

特に$(X, Y)^{\mathrm{T}} \sim N_2(\bm{\mu}, \bm{\Sigma})$のとき，
\begin{equation}
  \rho = 0 \, \Longleftrightarrow \, XとYは独立 \nonumber
\end{equation}
が成り立つ\footnote{
($\Longleftarrow$)は明らか．($\Longrightarrow$)は2次元(多次元)正規分布の重要な性質(一般には成り立たない)．
}．
\begin{description}
  \item[(証明)]
  \begin{description}
    \item[($\Longleftarrow$)]
    定理\ref{theo:joint}より，
    \begin{equation}
      \rho = \frac{Cov(X, Y)}{\sqrt{V[X]}\sqrt{V[y]}} = 0 \nonumber
    \end{equation}
    \item[($\Longrightarrow$)]
    $\rho = 0$のとき，
    \begin{equation}
      f_{XY}(x, y) = f_X(x)f_Y(y) \; \; (\forall x, y) \nonumber
    \end{equation}
  \end{description}
\end{description}

以上をまとめると，$(X, Y)^{\mathrm{T}} \sim N_2(\bm{\mu}, \bm{\Sigma})$とすると，
\begin{equation}
  \bm{\mu} = \left(
  \begin{array}{c}
    \mu_X \\
    \mu_Y
  \end{array}
  \right) = \left(
  \begin{array}{c}
    E[X] \\
    E[Y]
  \end{array}
  \right), \; \; \;
  \bm{\Sigma} = \left(
  \begin{array}{cc}
    \sigma_X^2 & \rho \sigma_X \sigma_Y \\
    \rho \sigma_X \sigma_Y & \sigma_Y^2
  \end{array}
  \right) = \left(
  \begin{array}{cc}
    V[X] & Cov(X, Y) \\
    Cov(X, Y) & V[Y]
  \end{array}
  \right) \nonumber
\end{equation}
である．
\end{document}
